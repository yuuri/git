#!/bin/rc
# Plan 9 C compiler rejects initialization a structure including bit field.
# usage: remove-bitfields.rc [dir ...]

fn sigexit sighup sigint sigquit sigterm {
	rm -f /tmp/remove-bitfields.$pid
	exit
}

files=`{du -a $* | awk '/\.[ch]$/ { print $2 }'}
for(i in $files){
	sed '/(^[ 	]*\*|\?)/!s/([a-z]+[a-z0-9]*) *: *[0-9]+([,;])/\1\2/g' $i >/tmp/remove-bitfields.$pid
	cp /tmp/remove-bitfields.$pid $i
}
